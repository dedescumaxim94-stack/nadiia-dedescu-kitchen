<!DOCTYPE html>
<%
  const defaultNavCategories = [
    { slug: 'breakfast', title: 'Breakfast' },
    { slug: 'lunch', title: 'Lunch' },
    { slug: 'dinner', title: 'Dinner' },
    { slug: 'dessert', title: 'Dessert' },
    { slug: 'set-menu', title: 'Set Menu' },
  ];
  const incomingNavCategories = typeof navCategories !== 'undefined' ? navCategories : null;
  const safeNavCategories = Array.isArray(incomingNavCategories) && incomingNavCategories.length
    ? incomingNavCategories
    : defaultNavCategories;
%>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %> - Nadiia's Kitchen</title>
  <script>
    (function () {
      try {
        const storedTheme = localStorage.getItem("ndk-theme");
        if (storedTheme === "light" || storedTheme === "dark") {
          document.documentElement.setAttribute("data-theme", storedTheme);
        }
      } catch {}
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,600;9..144,700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/style.css" />
  <% if (typeof categoryPageCSS !== 'undefined' && categoryPageCSS) { %>
    <link rel="stylesheet" href="/css/category.css" />
  <% } %>
  <% if (typeof recipePageCSS !== 'undefined' && recipePageCSS) { %>
    <link rel="stylesheet" href="/css/recipe.css" />
  <% } %>
  <% if (typeof newRecipePageCSS !== 'undefined' && newRecipePageCSS) { %>
    <link rel="stylesheet" href="/css/new-recipe.css" />
  <% } %>
  <% if (typeof loginPageCSS !== 'undefined' && loginPageCSS) { %>
    <link rel="stylesheet" href="/css/login.css" />
  <% } %>
  <% if (typeof adminPageCSS !== 'undefined' && adminPageCSS) { %>
    <link rel="stylesheet" href="/css/admin.css" />
  <% } %>
</head>

<body class="public-body">
  <nav id="site-menu" class="side-menu" aria-label="Main menu">
    <div class="menu-header">
      <a class="menu-brand" href="/">
        <img src="/src/svg/nadiia-dedescu-kitchen-logo.svg" alt="Nadiia Dedescu's Kitchen Logo" height="72" />
      </a>
      <button class="menu-icon-btn menu-close-btn" aria-label="Close menu">
        <img src="/src/svg/menu-icon.svg" alt="" height="36" />
      </button>
    </div>

    <ul class="menu-list">
      <li>
        <a href="/" class="menu-link <%= activePage === 'home' ? 'active' : '' %>">Home</a>
      </li>
      <li class="menu-item">
        <button class="menu-title" aria-expanded="true" aria-controls="recipes-dropdown">Recipes</button>
        <ul id="recipes-dropdown" class="dropdown open">
          <% safeNavCategories.forEach(function(category) { %>
            <li class="<%= activePage === category.slug ? 'active' : '' %>">
              <a href="/categories/<%= category.slug %>"><%= category.title %></a>
            </li>
          <% }); %>
        </ul>
      </li>
    </ul>
  </nav>

  <button class="menu-backdrop" type="button" aria-label="Close menu"></button>

  <div class="site-shell">
    <header class="header">
      <button class="menu-icon-btn menu-open-btn" aria-label="Open menu" aria-controls="site-menu" aria-expanded="false">
        <img src="/src/svg/menu-icon.svg" alt="" height="36" />
      </button>

      <a class="header-logo" href="/">
        <img src="/src/svg/logo.svg" alt="Nadiia's Kitchen" height="50" />
      </a>

      <div class="header-copy">
        <p class="header-kicker">Nadiia Dedescu's Kitchen</p>
        <h1><%= title %></h1>
      </div>

      <div class="header-auth">
        <% if (auth && auth.isAdmin) { %>
          <a class="header-link" href="/admin">Admin</a>
          <form method="post" action="/logout" class="logout-form">
            <input type="hidden" name="_csrf" value="<%= csrfToken || '' %>" />
            <button type="submit" class="header-link header-link-btn">Logout</button>
          </form>
        <% } else { %>
          <a class="header-link" href="/login">Login</a>
        <% } %>
      </div>
    </header>

    <div class="page-container">
      <%- body %>
    </div>
  </div>

  <button type="button" class="theme-toggle site-theme-toggle" data-theme-toggle aria-label="Switch color theme" aria-pressed="false">
    <span class="theme-toggle-icon" data-theme-toggle-icon>ðŸŒ™</span>
    <span data-theme-toggle-text>Dark</span>
  </button>

  <script src="/js/script.js"></script>
  <% if (typeof newRecipePageJS !== 'undefined' && newRecipePageJS) { %>
    <script src="/js/new-recipe.js"></script>
  <% } %>
</body>
</html>
