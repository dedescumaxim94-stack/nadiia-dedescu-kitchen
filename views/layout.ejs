<!DOCTYPE html>
<%
  const defaultNavCategories = [
    { slug: 'breakfast', title: 'Breakfast' },
    { slug: 'lunch', title: 'Lunch' },
    { slug: 'dinner', title: 'Dinner' },
    { slug: 'dessert', title: 'Dessert' },
    { slug: 'set-menu', title: 'Set Menu' },
  ];
  const incomingNavCategories = typeof navCategories !== 'undefined' ? navCategories : null;
  const safeNavCategories = Array.isArray(incomingNavCategories) && incomingNavCategories.length
    ? incomingNavCategories
    : defaultNavCategories;
%>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %> - Nadiia's Kitchen</title>
  <script>
    (function () {
      try {
        const storedTheme = localStorage.getItem("ndk-theme");
        if (storedTheme === "light" || storedTheme === "dark") {
          document.documentElement.setAttribute("data-theme", storedTheme);
        }
      } catch {}
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,600;9..144,700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/style.css" />
  <% if (typeof categoryPageCSS !== 'undefined' && categoryPageCSS) { %>
    <link rel="stylesheet" href="/css/category.css" />
  <% } %>
  <% if (typeof recipePageCSS !== 'undefined' && recipePageCSS) { %>
    <link rel="stylesheet" href="/css/recipe.css" />
  <% } %>
  <% if (typeof newRecipePageCSS !== 'undefined' && newRecipePageCSS) { %>
    <link rel="stylesheet" href="/css/new-recipe.css" />
  <% } %>
  <% if (typeof loginPageCSS !== 'undefined' && loginPageCSS) { %>
    <link rel="stylesheet" href="/css/login.css" />
  <% } %>
  <% if (typeof adminPageCSS !== 'undefined' && adminPageCSS) { %>
    <link rel="stylesheet" href="/css/admin.css" />
  <% } %>
</head>

<body class="public-body">
  <nav id="site-menu" class="side-menu" aria-label="Main menu">
    <div class="menu-header">
      <a class="menu-brand" href="/">
        <img src="/src/svg/nadiia-dedescu-kitchen-logo.svg" alt="Nadiia Dedescu's Kitchen Logo" height="72" />
      </a>
      <button class="menu-icon-btn menu-close-btn" aria-label="Close menu">
        <img src="/src/svg/menu-icon.svg" alt="" height="36" />
      </button>
    </div>

    <ul class="menu-list">
      <li>
        <a href="/" class="menu-link <%= activePage === 'home' ? 'active' : '' %>">Home</a>
      </li>
      <li class="menu-item">
        <button class="menu-title" aria-expanded="true" aria-controls="recipes-dropdown">Recipes</button>
        <ul id="recipes-dropdown" class="dropdown open">
          <% safeNavCategories.forEach(function(category) { %>
            <li class="<%= activePage === category.slug ? 'active' : '' %>">
              <a href="/categories/<%= category.slug %>"><%= category.title %></a>
            </li>
          <% }); %>
        </ul>
      </li>
    </ul>
  </nav>

  <button class="menu-backdrop" type="button" aria-label="Close menu"></button>

  <div class="site-shell">
    <header class="header">

      <button class="menu-icon-btn menu-open-btn" aria-label="Open menu" aria-controls="site-menu" aria-expanded="false">
        <svg fill="currentColor" width="36" height="36" viewBox="0 0 24.75 24.75" aria-hidden="true" focusable="false">
          <g>
            <path d="M0,3.875c0-1.104,0.896-2,2-2h20.75c1.104,0,2,0.896,2,2s-0.896,2-2,2H2C0.896,5.875,0,4.979,0,3.875z M22.75,10.375H2
              c-1.104,0-2,0.896-2,2c0,1.104,0.896,2,2,2h20.75c1.104,0,2-0.896,2-2C24.75,11.271,23.855,10.375,22.75,10.375z M22.75,18.875H2
              c-1.104,0-2,0.896-2,2s0.896,2,2,2h20.75c1.104,0,2-0.896,2-2S23.855,18.875,22.75,18.875z"/>
          </g>
        </svg>
      </button>

      <a class="header-logo" href="/">
        <svg width="50" height="50" viewBox="0 -3 32 32" fill="currentColor" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
          <g id="Icon-Set" transform="translate(-464.000000, -414.000000)" fill="currentColor">
            <path d="M466,434 C466,426.268 472.268,420 480,420 C487.732,420 494,426.268 494,434 L466,434 L466,434 Z M481,418 L481,416 L483,416 C483.553,416 484,415.553 484,415 C484,414.448 483.553,414 483,414 L477,414 C476.447,414 476,414.448 476,415 C476,415.553 476.447,416 477,416 L479,416 C479,416 478.993,418.082 479,418 C470.632,418.519 464,425.501 464,434 L464,435 C464,435.553 464.447,436 465,436 L495,436 C495.553,436 496,435.553 496,435 L496,434 C496,425.501 489.368,418.519 481,418 L481,418 Z M495,438 L465,438 C464.447,438 464,438.448 464,439 C464,439.553 464.447,440 465,440 L495,440 C495.553,440 496,439.553 496,439 C496,438.448 495.553,438 495,438 L495,438 Z"/>
          </g>
        </svg>
      </a>

      <div class="header-copy">
        <p class="header-kicker">Nadiia Dedescu's Kitchen</p>
        <h1><%= title %></h1>
      </div>

      <div class="header-auth">
        <% if (auth && auth.isAdmin) { %>
          <a class="header-link" href="/admin">Admin</a>
          <form method="post" action="/logout" class="logout-form">
            <input type="hidden" name="_csrf" value="<%= csrfToken || '' %>" />
            <button type="submit" class="header-link header-link-btn">Logout</button>
          </form>
        <% } else { %>
          <a class="header-link" href="/login">Login</a>
        <% } %>
      </div>
    </header>

    <div class="page-container">
      <%- body %>
    </div>
  </div>

  <button type="button" class="theme-toggle site-theme-toggle" data-theme-toggle aria-label="Switch color theme" aria-pressed="false">
    <span class="theme-toggle-icon" data-theme-toggle-icon>ðŸŒ™</span>
    <span data-theme-toggle-text>Dark</span>
  </button>

  <script src="/js/script.js"></script>
  <% if (typeof newRecipePageJS !== 'undefined' && newRecipePageJS) { %>
    <script src="/js/new-recipe.js"></script>
  <% } %>
</body>
</html>
